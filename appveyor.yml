# General Configuration
version: 1.0.{build}
skip_branch_with_pr: true

# Environment Configuration
image: Visual Studio 2017
cache:
  - '%LocalAppData%\NuGet\v3-cache'

install:
  #init and update submodules
  - git submodule update --recursive --init

 # version
assembly_info:
  patch: true
  file: AssemblyVersionInfo.*
  assembly_version: '{version}'
  assembly_file_version: '{version}'


# Build Configuration
platform: Any CPU
configuration: Release


before_build:
  - nuget restore

build:
  project: SpeckleCoreGeometry.sln
  verbosity: minimal

after_build:
  # remove garbage
  - Remove-Item "%APPVEYOR_BUILD_FOLDER%\SpeckleCoreGeometry\bin\Release\x86" -Recurse -ErrorAction Ignore
  - Remove-Item "%APPVEYOR_BUILD_FOLDER%\SpeckleCoreGeometry\bin\Release\x86" -Recurse -ErrorAction Ignore
  - Remove-Item "%APPVEYOR_BUILD_FOLDER%\SpeckleCoreGeometry\bin\Release\*.pdb" -Recurse -ErrorAction Ignore
  # zip everything into a zip file containing package folder structure
  - 7z a SpeckleCoreGeometry-%APPVEYOR_BUILD_VERSION%.zip "%APPVEYOR_BUILD_FOLDER%\SpeckleCoreGeometry\bin\Release\*"

artifacts:
  path: SpeckleCoreGeometry-%APPVEYOR_BUILD_VERSION%.zip
  name: Release